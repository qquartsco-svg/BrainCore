# 설계 불변 원칙 (Design Invariants)

**작성일**: 2026-02-05  
**버전**: 0.2.0

---

## 🎯 핵심 정체성

### 이 시스템은 무엇인가?

**상태 중심 동역학 통합 인프라**

- 오케스트레이터가 아니다
- 엔진 컨트롤러가 아니다
- **상태 공간 중심 시스템**이다

---

## 🔴 State Invariant (상태 불변 원칙)

### 1. GlobalState 최소 코어 원칙

**불변 원칙**:
- GlobalState는 최소 코어만 가진다
- 엔진 전용 필드는 extensions로 간다
- Core 필드: `state_vector`, `energy`, `risk`, `step`, `timestamp`, `metadata`
- Extensions: `{engine_name: data}`

**위반 시**: 필드 폭발, 의존성 증가, 확장 불가

---

### 2. BrainCore 소유권 원칙

**불변 원칙**:
- BrainCore는 상태를 소유하지 않는다
- BrainCore는 상태를 전달하고 업데이트만 조율한다
- 상태는 엔진들이 공유하는 공통 자원이다

**위반 시**: 상태 소유권 충돌, 엔진 간 결합도 증가

---

### 3. 엔진 지배 금지 원칙

**불변 원칙**:
- 엔진은 상태를 mutate하지만 지배하지 않는다
- 엔진은 상태를 perturb하여 변화시킬 뿐이다
- 상태의 최종 형태는 엔진들의 상호작용 결과이다

**위반 시**: 엔진 독점, 시스템 경직화

---

### 4. 상태 중심 실행 원칙

**불변 원칙**:
- 실행 모델: 상태 업데이트 중심
- 수식: `state_{t+1} = engine.update(state_t)`
- 엔진은 순차적으로 상태를 업데이트한다
- 최종 상태는 에너지 최소화 수렴을 목표로 한다

**위반 시**: 실행 모델 혼란, 예측 불가능한 동작

---

## 🔴 Execution Model (실행 모델)

### 기본 실행 모델

**동기화 상태 업데이트 (Synchronized State Updates)**

1. **초기 상태 설정**
   ```
   state_0 = GlobalState(state_vector, energy, risk, ...)
   ```

2. **엔진 순차 실행**
   ```
   for engine in engines:
       state = engine.update(state)
   ```

3. **수렴 체크**
   ```
   if |E_{t+1} - E_t| < ε:
       break
   ```

**특징**:
- 순차 파이프라인 아님 (엔진이 독립적으로 실행되지 않음)
- 동기화 업데이트 (각 엔진이 상태를 업데이트)
- 에너지 최소화 수렴 (최종 목표)

---

## 🔴 방어적 설계 원칙

### 이 시스템은 무엇을 하지 않는가?

1. **직접 PDE 해결하지 않음**
   - Navier-Stokes를 직접 계산하지 않음
   - 물리 시뮬레이션을 직접 수행하지 않음
   - 외부 물리 시뮬레이터의 결과를 받아서 처리함

2. **도메인 특정 물리 하드코딩하지 않음**
   - 특정 물리 법칙을 시스템에 고정하지 않음
   - 확장 가능한 인터페이스로 물리 데이터를 받음

3. **상태 통합과 위험 지형 매핑에 집중**
   - 여러 엔진의 상태를 통합
   - 위험 지형(risk landscape)을 매핑
   - 안전한 경로를 찾는 것이 목표

---

## ✅ 불변 원칙 체크리스트

확장 시 다음을 확인하세요:

- [ ] GlobalState에 Core 필드를 추가하지 않았는가?
- [ ] BrainCore가 상태를 소유하지 않는가?
- [ ] 엔진이 상태를 지배하지 않는가?
- [ ] 실행 모델이 상태 업데이트 중심인가?
- [ ] 직접 PDE를 해결하려고 하지 않는가?
- [ ] 도메인 특정 물리를 하드코딩하지 않았는가?

---

## 🎯 큰 줄기 유지 원칙

### 확장 시 준수 사항

1. **상태 중심성 유지**
   - 모든 확장은 상태 업데이트 중심
   - 엔진은 상태를 perturb하는 모듈

2. **최소 코어 유지**
   - GlobalState Core는 최소한으로 유지
   - 확장은 Extensions로

3. **실행 모델 일관성**
   - 기본 실행 모델 변경 금지
   - 확장은 엔진 추가로만

---

**작성자**: GNJz (Qquarts)  
**상태**: 설계 불변 원칙 정의 완료

